# Django Weather App

Это веб-приложение на Django, позволяющее пользователю получить прогноз погоды в указанном городе.

## Возможности

- Ввод названия города и отображение прогноза погоды.
- Использование внешнего погодного API: [Open-Meteo](https://open-meteo.com/).
- Прогноз погоды отображается в формате датафрейма (таблица).
- При повторном посещении сайта пользователю предлагается посмотреть погоду в ранее введённом городе (используются cookies).
- Сохраняется история поисков по каждому городу.
- API, отображающее, сколько раз и какой город запрашивали.
- Поддержка анонимных пользователей (подсчёт запросов и последнее посещение — через cookies).
- Покрытие проекта тестами.

## Используемые технологии

- Python 3.10
- Django 5.2.1
- Django REST Framework 3.16
- SQLite (используется по умолчанию; файл базы не включён в репозиторий)
- requests
- pandas
- openmeteo_requests
- pytest — для тестирования

## Установка и запуск

1. **Клонируйте репозиторий:**
```bash
  git clone https://github.com/katyaaa86/weather_forecast.git
```
2. **Создайте виртуальное окружение:**
 ```bash
  python -m venv venv
  source venv/bin/activate
```
и создайте файл .env с переменными виртуального окружения (за основу можно взять файл .env.example)

3. **Установите зависимости:**
```bash
   pip install -r requirements.txt
```
   
4. **Выполните миграции и создайте суперпользователя:**
 ```bash
  python manage.py migrate
  python manage.py createsuperuser
```
5. **Запустите сервер разработки:**
    ```bash
   python manage.py runserver
   ```
6. **Откройте в браузере:**
    ```bash
   http://localhost:8000
   ```

## Авторизация

- Авторизация на сайте не требуется
- Добавление новых пользователей доступно только через admin-панель
- Для доступа в админ-панель — переход по адресу /admin и вход с учётными данными суперпользователя
- Анонимные пользователи тоже учитываются: сохраняется последний город через cookie и ведётся подсчёт для анонимных запросов

# Тестирование
Для запуска тестов:
```bash
  pytest
```

# API
API доступно по адресу:
```bash
  http://localhost:8000/api/
```

**Endpoint**: ```/api/city_search/```
- **Метод**: ```GET```
- **Описание**: Возвращает список всех городов, сохранённых в базе, с указанием координат и количества запросов для каждого города.
- **Пример ответа**:
```json
[
  {
    "id": 1,
    "url": "http://localhost:8000/api/city_search/1/",
    "name": "London",
    "latitude": 51.5074,
    "longitude": -0.1278,
    "search_count": 5
  },
  {
    "id": 2,
    "url": "http://localhost:8000/api/city_search/2/",
    "name": "Paris",
    "latitude": 48.8566,
    "longitude": 2.3522,
    "search_count": 3
  }
]
```

**Endpoint**: ```/api/city_search/{id}```
- **Метод**: ```GET```
- **Описание**: Возвращает данные по конкретному городу (по его id) — координаты и сколько раз он был запрошен.
- **Пример ответа**:
```json
{
  "id": 1, 
  "url": "http://127.0.0.1:8000/api/city_search/1/",
  "name": "London",
  "latitude": 51.5074,
  "longitude": -0.1278,
  "search_count": 5
}
```
